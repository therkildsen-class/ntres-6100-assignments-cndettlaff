---
title: "Lab 5 Titanic"
format: gfm
editor: visual
---

## 

```{r}
#| message: false
#| warning: false
#| echo: false

library(tidyverse)
library(ggplot2)
library(dplyr)
library(skimr)
library(knitr)
titanic <- read_csv("https://raw.githubusercontent.com/nt246/NTRES-6100-data-science/master/datasets/Titanic.csv")

```

# Titanic Data and Notes

```{r}
#| echo: false
head(titanic, n = 5) |>
  kable()
tail(titanic, n = 5) |> 
  kable()
```

```{r}
#| echo: false
notes <- read_csv("https://raw.githubusercontent.com/nt246/NTRES-6100-data-science/master/datasets/Notes.csv")
kable(notes)

```

#### **Question 1: According to Wikipedia, there was an estimated 2,224 passengers and crew onboard the Titanic when it sank. How many of them do we have information for in this dataset? Of the people we have data for, how many of them survived and how many did not? What is the overall survival rate?**

```{r}
#| echo: false


Survival <- titanic |> 
  select(PassengerId, Survived) |> 
  summarise(Total_Passenger = nrow(titanic),
            Survivors = sum(Survived),
            Deaths = sum(nrow(titanic) - Survivors),
            Survival_Rate = sum(Survivors/nrow(titanic)*100),
            Death_Rate = sum(Deaths/nrow(titanic)*100))
Survival |> 
  head() |> 
  kable() 

# make pivot_longer to bring Both Rates together and bring Survivor/Deaths together by Type
```

#### **Question 2. How many passengers on the Titanic were males and how many were females? What do you find when you break it down by ticket class?**

```{r}
#| echo: false

sex_count <- titanic |> 
  count(Sex)
kable(sex_count)

sex_class_count <- titanic |> 
  group_by(Sex,Pclass) |> 
  count()
kable(sex_class_count)

sex_class_count |> 
  ggplot(aes(x = Sex, y = n)) +
  geom_col(aes(fill = Sex)) +
  facet_wrap(~ Pclass) +
  ylab("Count")
```

#### **Question 3. How many passengers of each sex survived and how many of them did not? What is the survival rate for passengers of each sex?**

```{r}
#| echo: false

gender_rate <- titanic |> 
  mutate(Survived = ifelse(Survived == 0, "no", "yes")) |> 
  group_by(Sex, Survived) |> 
  count() |> 
  group_by(Sex) |> 
  mutate(percentage = round(n/sum(n)* 100, 2))
kable(gender_rate)
# make graph
```

#### **Question 4. For how many passengers do we have age information (including estimated age)? For how many is the age information missing? What is the age distribution for passengers whose age information is available?**

```{r}
#| echo: false

age_count <- titanic |> 
  mutate(age_info = ifelse(is.na(Age), "missing", "available")) |> 
  count(age_info)
kable(age_count)

#graph 1

age_count |> 
  ggplot(aes(x = age_info, y = n)) +
  geom_col(aes(fill = age_info)) +
  geom_label(aes(y = n + 30, label = n)) +
  coord_flip()
  

titanic |> 
  filter(!is.na(Age)) |> 
  summary(Age)

#graph 2

titanic |> 
  filter(!is.na(Age)) |> 
  ggplot(aes(x = Age)) +
  geom_histogram()
  
```

#### **Question 5. Show the age distribution per ticket class, per sex. What do you find?**

```{r}
#| echo: false
#| message: false
#| warning: false

titanic |> 
  filter(!is.na(Age)) |> 
  ggplot(aes(x = Age, fill = Sex)) +
  geom_histogram() +
  facet_grid(Pclass ~ Sex)
```

#### **Question 6. How do the sex, ticket class, and age of a passenger affect their chance of survival? Try to use a single plot to answer this question.**

```{r}
#| echo: false
#| message: false
#| warning: false

titanic |> 
  filter(!is.na(Age)) |> 
  mutate(survived = ifelse(Survived == 0, "no", "yes")) |> 
  ggplot(aes(x = Age, fill = survived)) + 
  geom_histogram(position = "stack", color = "black") + 
  facet_grid(Pclass ~ Sex)

```

#### **Question 7. Show the distribution of the number of family members (including siblings, spouses, parents, and children) that each passenger was accompanied by. Were most passengers travelling solo or with family?**

```{r}
#| echo: false
#| message: false
#| warning: false

titanic |>
  mutate(n_family = SibSp + Parch) |>
  ggplot(aes(x = n_family)) +
  geom_bar() +
  scale_x_continuous(breaks = 0:10)

titanic |>
  mutate(n_family=SibSp+Parch, with_family=ifelse(n_family>0, "yes", "no")) |>
  ggplot(aes(x=with_family)) +
  geom_bar()
```

#### **Question 8. Which ticket class did most of the largest families get? And which ticket class has the lowest proportion of female passengers who travelled solo out of all the female passengers in that class?**

```{r}
#| echo: false
#| message: false
#| warning: false

titanic |>
  mutate(n_family = SibSp + Parch) |>
  ggplot(aes(x = n_family)) +
  geom_bar() +
  scale_x_continuous(breaks = 0:10) +
  facet_wrap(~Pclass, ncol = 1)

titanic |>
  mutate(n_family = SibSp+Parch, ticket_class = as.character(Pclass)) |>
  ggplot(aes(x = n_family, fill = ticket_class)) +
  geom_bar(color = "black", position = "fill") +
  scale_x_continuous(breaks = 0:10) +
  ylab("proportion") +
  coord_flip()
```

#### **Question 9. In this dataset, the Fare variable does not represent the fare per person. Instead, each ticket number has a corresponding fare, and some passengers share one single ticket number. Therefore, the Fare variable is the total fare for a group of passengers sharing the same ticket number. Knowing this, calculate the average fare per person. You donâ€™t need to show a table or a figure for this question, just show the code for the calculation.**

```{r}

```

#### **Question 10. What is the distribution of the per-ticket fare for each ticket class?**

```{r}

```
